{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 10, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Elli0t/richard/app/actions/auth.ts"],"sourcesContent":["'use server'\r\n\r\nimport bcrypt from 'bcryptjs'\r\nimport { db } from '@/lib/db'\r\nimport { users } from '@/lib/schema'\r\nimport { cookies } from 'next/headers'\r\nimport { redirect } from 'next/navigation'\r\nimport { eq } from 'drizzle-orm'\r\n\r\nexport async function registerUser(formData: FormData) {\r\n  const email = formData.get('email') as string\r\n  const password = formData.get('password') as string\r\n\r\n  if (!email || !password) {\r\n    return { error: 'Email and password are required' }\r\n  }\r\n\r\n  try {\r\n    // Check if user exists\r\n    const existingUser = await client.execute({\r\n      sql: 'SELECT id FROM users WHERE email = ?',\r\n      args: [email]\r\n    })\r\n\r\n    if (existingUser.rows.length > 0) {\r\n      return { error: 'User already exists' }\r\n    }\r\n\r\n    // Hash password\r\n    const passwordHash = await bcrypt.hash(password, 10)\r\n\r\n    // Insert user\r\n    const result = await client.execute({\r\n      sql: 'INSERT INTO users (email, password_hash) VALUES (?, ?)',\r\n      args: [email, passwordHash]\r\n    })\r\n\r\n    const userId = result.lastInsertRowid as bigint\r\n\r\n    // Set cookie for session\r\n    const cookieStore = await cookies()\r\n    cookieStore.set('user_id', userId.toString(), {\r\n      httpOnly: true,\r\n      secure: process.env.NODE_ENV === 'production',\r\n      maxAge: 60 * 60 * 24 * 7 // 7 days\r\n    })\r\n\r\n    return { success: true, userId: userId.toString() }\r\n  } catch (error) {\r\n    console.error('Registration error:', error)\r\n    return { error: 'Failed to register user' }\r\n  }\r\n}\r\n\r\nexport async function loginUser(formData: FormData) {\r\n  const email = formData.get('email') as string\r\n  const password = formData.get('password') as string\r\n\r\n  if (!email || !password) {\r\n    return { error: 'Email and password are required' }\r\n  }\r\n\r\n  try {\r\n    // Get user\r\n    const result = await client.execute({\r\n      sql: 'SELECT id, password_hash FROM users WHERE email = ?',\r\n      args: [email]\r\n    })\r\n\r\n    if (result.rows.length === 0) {\r\n      return { error: 'Invalid credentials' }\r\n    }\r\n\r\n    const user = result.rows[0] as unknown as { id: number; password_hash: string }\r\n    const isValidPassword = await bcrypt.compare(password, user.password_hash)\r\n\r\n    if (!isValidPassword) {\r\n      return { error: 'Invalid credentials' }\r\n    }\r\n\r\n    // Set cookie\r\n    const cookieStore = await cookies()\r\n    cookieStore.set('user_id', user.id.toString(), {\r\n      httpOnly: true,\r\n      secure: process.env.NODE_ENV === 'production',\r\n      maxAge: 60 * 60 * 24 * 7\r\n    })\r\n\r\n    return { success: true, userId: user.id }\r\n  } catch (error) {\r\n    console.error('Login error:', error)\r\n    return { error: 'Failed to login' }\r\n  }\r\n}\r\n\r\nexport async function logoutUser() {\r\n  const cookieStore = await cookies()\r\n  cookieStore.delete('user_id')\r\n  redirect('/login')\r\n}\r\n\r\nexport async function getCurrentUser() {\r\n  const cookieStore = await cookies()\r\n  const userId = cookieStore.get('user_id')?.value\r\n\r\n  if (!userId) {\r\n    return null\r\n  }\r\n\r\n  try {\r\n    const result = await client.execute({\r\n      sql: 'SELECT id, email, created_at FROM users WHERE id = ?',\r\n      args: [parseInt(userId)]\r\n    })\r\n\r\n    if (result.rows.length === 0) {\r\n      return null\r\n    }\r\n\r\n    return result.rows[0] as unknown as { id: number; email: string; created_at: string }\r\n  } catch (error) {\r\n    console.error('Get user error:', error)\r\n    return null\r\n  }\r\n}"],"names":[],"mappings":"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"}},
    {"offset": {"line": 168, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Elli0t/richard/.next-internal/server/app/login/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {loginUser as '407fe4477a674799f3a7590b1590a785bf93da7eb8'} from 'ACTIONS_MODULE0'\n"],"names":[],"mappings":";AAAA"}}]
}